/*! { "name": "vissense-percentage-time-test", "version": "0.3.0", "copyright": "(c) 2015 tbk" } */
!function(a,b){"use strict";b(a,a.VisSense,a.VisSense.Utils)}(this,function(a,b,c,d){"use strict";var e=function(a,d,e){var f=0,g=null,h=e.timeLimit,i=e.percentageLimit,j=e.interval;return a.visobj().monitor({strategy:new b.VisMon.Strategy.PollingStrategy({interval:j}),update:function(b){var e=b.state().percentage;if(i>e)g=null;else{var j=c.now();g=g||j,f=j-g}f>=h&&(b.stop(),a.stop(),d())},stop:function(){g=null}})},f=function(a,f,g){var h=c.defaults(g,{percentageLimit:1,timeLimit:1e3,interval:100,strategy:d}),i=Math.max(h.percentageLimit-.01,0),j=null,k=new b(a,{hidden:i}).monitor({strategy:h.strategy,visible:function(a){null===j&&(j=e(a,f,h)),j.start()},hidden:function(){null!==j&&j.stop()},stop:function(){null!==j&&j.stop()}});return k.start(),function(){k.stop(),j=null}},g=function(a,b,d){return f(a,b,c.extend(d||{},{percentageLimit:.5,timeLimit:1e3,interval:100}))};b.fn.onPercentageTimeTestPassed=function(a,b){f(this.element(),a,b)},b.fn.on50_1TestPassed=function(a,b){g(this.element(),a,b)},b.VisMon.Strategy.PercentageTimeTestEventStrategy=function(a){var b=function(a,b){var d=c.defaults(b,{eventName:"percentage-time-test-passed"}),e=c.noop,g=a.on("visible",c.once(function(a){e=f(a.visobj().element(),function(){var b={monitorState:a.state(),testConfig:d};a.publish(d.eventName,[a,b])},b),g()}));return function(){g(),e()}},d=c.noop;return{init:function(c){d=b(c,a)},stop:function(){d()}}}});