/*! { "name": "vissense-percentage-time-test", "version": "0.5.0", "copyright": "(c) 2015 tbk" } */
!function(a,b){"use strict";b(a,a.VisSense,a.VisSense.Utils)}(this,function(a,b,c,d){"use strict";var e=function(a,d,e){var f=0,g=null,h=e.timeLimit,i=e.percentageLimit,j=e.interval;return b.VisMon.Builder(a.visobj()).strategy(new b.VisMon.Strategy.PollingStrategy({interval:j})).on("update",function(b){var e=b.state().percentage;if(i>e)g=null;else{var j=c.now();g=g||j,f=j-g}f>=h&&(b.stop(),a.stop(),d(b))}).on("stop",function(){g=null}).build()},f=function(a,f,g){var h=c.defaults(g,{percentageLimit:1,timeLimit:1e3,interval:100,strategy:d}),i=Math.max(h.percentageLimit-.001,0),j=null,k=b.VisMon.Builder(new b(a.element(),{hidden:i,referenceWindow:a.referenceWindow()})).set("strategy",h.strategy).on("visible",function(a){null===j&&(j=e(a,f,h)),j.start()}).on("hidden",function(){null!==j&&j.stop()}).on("stop",function(){null!==j&&j.stop()}).build();return k.start(),function(){k.stop(),j=null}};b.fn.onPercentageTimeTestPassed=function(a,b){f(this,a,b)},b.fn.on50_1TestPassed=function(a,b){var d=c.extend(c.defaults(b,{interval:100}),{percentageLimit:.5,timeLimit:1e3});f(this,a,d)},b.VisMon.Strategy.PercentageTimeTestEventStrategy=function(a,b){var d=function(b,d){var e=c.noop,g=b.on("visible",c.once(function(b){e=f(b.visobj(),function(c){var e={monitorState:c.state(),testConfig:d};b.update(),b.publish(a,[b,e])},d),g()}));return function(){g(),e()}},e=c.noop;return{init:function(a){e=d(a,b)},stop:function(){e()}}}});